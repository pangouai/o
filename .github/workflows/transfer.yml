name: OneDrive to OneDrive (Resume Safe)

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'   # 每 6 小时跑一次（刚好卡上限）

jobs:
  transfer:
    runs-on: ubuntu-latest
    timeout-minutes: 350    # 提前 10 分钟退出，防止被强杀

    steps:
    - uses: actions/checkout@v4

    - name: Install rclone
      run: curl https://rclone.org/install.sh | sudo bash

    - name: Setup rclone config
      run: |
        mkdir -p ~/.config/rclone
        echo "${{ secrets.RCLONE_CONF }}" > ~/.config/rclone/rclone.conf

    - name: Resume-safe transfer
      run: |
        rclone copy \
          od_src:/ \
          od_dst:/Backup \
          --progress \
          --transfers=2 \
          --checkers=4 \
          --drive-chunk-size=64M \
          --tpslimit=4 \
          --retries 10 \
          --low-level-retries 20 \
          --log-level INFO
