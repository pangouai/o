name: OneDrive to OneDrive

on:
  workflow_dispatch:
  schedule:
    - cron: '0 */6 * * *'

jobs:
  transfer:
    runs-on: ubuntu-latest
    timeout-minutes: 350

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Install rclone
        run: curl https://rclone.org/install.sh | sudo bash

      - name: Setup rclone config
        run: |
          mkdir -p ~/.config/rclone
          cat > ~/.config/rclone/rclone.conf << 'EOF'
          ${{ secrets.RCLONE_CONF }}
          EOF

      - name: Check remotes
        run: rclone listremotes

      - name: OneDrive copy
        run: |
          rclone copy ndja:/ n2:/ \
            --transfers=2 \
            --checkers=4 \
            --tpslimit=4 \
            --retries 20 \
            --low-level-retries 50 \
            --stats=0
